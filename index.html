<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Jur√≠dico Completo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* === ESTILOS GLOBAIS === */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a, #2F5496);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container { max-width: 100%; }
        
        /* === COMPONENTES DE LAYOUT === */
        .header {
            text-align: center;
            padding: 25px;
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .header h1, .header p {
            color: white !important; /* Corrigido para branco */
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin: 15px 0;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            border: 1px solid #eaeaea;
        }
        
        .data-item {
            background: #f8fafc;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #2F5496;
            transition: transform 0.2s;
        }
        
        .data-item:hover { transform: translateX(5px); }
        
        .search-box {
            background: #e3f2fd;
            padding: 18px;
            border-radius: 10px;
            margin: 12px 0;
        }
        
        /* === COMPONENTES DE FORMUL√ÅRIO === */
        .form-group { margin: 12px 0; }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #2F5496;
            font-size: 14px;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #2F5496;
            outline: none;
        }
        
        /* === COMPONENTES DE BOT√ÉO === */
        .btn {
            background: #2F5496;
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 8px;
            font-size: 14px;
            margin: 5px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            width: 100%;
            display: block;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .btn-danger { background: #dc3545; }
        .btn-success { background: #28a745; }
        .btn-warning { background: #ffc107; color: #000; }
        .btn-info { background: #17a2b8; }
        .btn-secondary { background: #6c757d; }
        
        .btn-small {
            padding: 8px 12px;
            font-size: 12px;
            width: auto;
            display: inline-block;
            margin: 2px;
        }
        
        .btn-atualizar {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            width: auto;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-atualizar:hover {
            background: #138496;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* === LAYOUT RESPONSIVO === */
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .clientes-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 12px 0;
        }
        
        .processos-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 12px 0;
            justify-content: space-between;
        }
        
        .teses-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .btn-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }
        
        .container-botoes {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
            gap: 15px;
        }
        
        .botoes-direita {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .botoes-internos {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eaeaea;
        }
        
        .botoes-internos .btn {
            margin: 5px 0;
            font-size: 13px;
            padding: 10px 15px;
        }
        
        /* === COMPONENTES ESPEC√çFICOS === */
        .stat-card {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 14px;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2F5496;
        }
        
        .processo-card {
            background: #e8f5e8;
            padding: 12px 8px;
            border-radius: 8px;
            text-align: center;
            font-size: 12px;
            flex: 1;
            min-width: 80px;
        }
        
        .processo-number {
            font-size: 16px;
            font-weight: bold;
            color: #2e7d32;
        }
        
        .tese-card {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            flex: 1;
            min-width: 200px;
        }
        
        .tese-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .tese-selecao {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .lista-clientes {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .cliente-item {
            background: #f8f9fa;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid #2F5496;
            font-size: 13px;
        }
        
        .cliente-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .cliente-codigo {
            background: #2F5496;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .total-clientes {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .total-clientes .numero {
            font-size: 24px;
            font-weight: bold;
            color: #2F5496;
        }
        
        /* === SISTEMA DE D√öVIDAS === */
        .lista-duvidas-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #2F5496;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .lista-duvidas-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .lista-duvidas-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .duvida-area {
            background: #2F5496;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .duvida-resumo {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .duvida-info {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #6c757d;
        }
        
        .duvida-expandida {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eaeaea;
            display: none;
        }
        
        .duvida-expandida.ativa { display: block; }
        
        .resposta-item {
            background: #e3f2fd;
            padding: 15px;
            margin: 10px 0 10px 20px;
            border-radius: 8px;
            border-left: 3px solid #2F5496;
        }
        
        .form-resposta {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .filtro-duvidas {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .filtro-botoes {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .filtro-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .filtro-btn.ativo { background: #2F5496; }
        .filtro-btn:hover { background: #5a6268; }
        
        .btn-excluir-duvida {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .btn-excluir-duvida:hover { background: #c82333; }
        
        /* === UTILIT√ÅRIOS === */
        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .print-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
            font-weight: 600;
        }
        
        .print-btn:hover { background: #5a6268; }
        
        /* === RESPONSIVIDADE === */
        @media (max-width: 768px) {
            .clientes-container { grid-template-columns: 1fr; }
        }
        
        @media print {
            .no-print { display: none !important; }
            .card { box-shadow: none; border: 1px solid #ddd; }
            body { background: white; color: black; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Dashboard -->
        <div id="dashboard" class="tab-content active">
            <div class="header">
                <h1>‚öñÔ∏è Sistema Jur√≠dico Completo</h1>
                <p>Controle de Clientes, Processos e Teses Jur√≠dicas</p>
            </div>

            <div class="card">
                <h3>üìä Dashboard</h3>
                <div class="stats-grid" id="stats-container">
                    <!-- Stats ser√£o preenchidos via JavaScript -->
                </div>

                <h4 style="margin: 15px 0 10px 0; color: #2F5496;">üìà Processos por √Årea</h4>
                <div class="processos-grid" id="processos-container">
                    <!-- Processos ser√£o preenchidos via JavaScript -->
                </div>
            </div>

            <div class="card">
                <h3>üöÄ A√ß√µes R√°pidas</h3>
                <div id="acoes-rapidas">
                    <!-- A√ß√µes ser√£o preenchidas via JavaScript -->
                </div>
            </div>
        </div>

        <!-- As outras abas ser√£o geradas dinamicamente via JavaScript -->
        <div id="abas-container"></div>
    </div>

    <!-- File Inputs para Importar Backup (hidden) -->
    <input type="file" id="backup-file-clientes" accept=".json" style="display: none;">
    <input type="file" id="backup-file-teses" accept=".json" style="display: none;">

    <script>
        // ========== SISTEMA DE BANCO DE DADOS ==========
        const DB = {
            clientes: JSON.parse(localStorage.getItem('sistema_juridico_clientes')) || [],
            processos: JSON.parse(localStorage.getItem('sistema_juridico_processos')) || [],
            andamentos: JSON.parse(localStorage.getItem('sistema_juridico_andamentos')) || [],
            teses: JSON.parse(localStorage.getItem('sistema_juridico_teses')) || { inicial: {}, impugnacao: {}, recurso: {} },
            duvidas: JSON.parse(localStorage.getItem('sistema_juridico_duvidas')) || [],
            
            salvar: function() {
                localStorage.setItem('sistema_juridico_clientes', JSON.stringify(this.clientes));
                localStorage.setItem('sistema_juridico_processos', JSON.stringify(this.processos));
                localStorage.setItem('sistema_juridico_andamentos', JSON.stringify(this.andamentos));
                localStorage.setItem('sistema_juridico_teses', JSON.stringify(this.teses));
                localStorage.setItem('sistema_juridico_duvidas', JSON.stringify(this.duvidas));
                this.atualizarInterface();
            },
            
            atualizarInterface: function() {
                atualizarEstatisticas();
                if (document.getElementById('clientes')?.classList.contains('active')) {
                    atualizarListaClientesRealtime();
                }
                if (document.getElementById('duvidas')?.classList.contains('active')) {
                    carregarDuvidas();
                }
            },
            
            gerarCodigoCliente: function() {
                const ultimoCodigo = this.clientes.reduce((max, cliente) => {
                    const num = parseInt(cliente.codigo) || 0;
                    return num > max ? num : max;
                }, 0);
                return String(ultimoCodigo + 1).padStart(3, '0');
            }
        };

        // ========== SISTEMA DE UTILIT√ÅRIOS ==========
        const Utils = {
            formatarCPF: function(input) {
                let value = input.value.replace(/\D/g, '');
                if (value.length > 11) value = value.substring(0, 11);
                
                if (value.length <= 11) {
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                }
                
                input.value = value;
            },

            formatarRG: function(input) {
                let value = input.value.replace(/\D/g, '');
                if (value.length > 9) value = value.substring(0, 9);
                
                if (value.length <= 9) {
                    value = value.replace(/(\d{2})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                }
                
                input.value = value;
            },

            mostrarFeedback: function(mensagem, tipo = 'success') {
                const feedback = document.createElement('div');
                feedback.style.position = 'fixed';
                feedback.style.top = '20px';
                feedback.style.right = '20px';
                feedback.style.background = tipo === 'success' ? '#28a745' : '#dc3545';
                feedback.style.color = 'white';
                feedback.style.padding = '15px 20px';
                feedback.style.borderRadius = '8px';
                feedback.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
                feedback.style.zIndex = '10000';
                feedback.style.fontWeight = '600';
                feedback.style.display = 'flex';
                feedback.style.alignItems = 'center';
                feedback.style.gap = '10px';
                
                feedback.innerHTML = '‚úÖ ' + mensagem;
                
                document.body.appendChild(feedback);
                
                setTimeout(() => {
                    feedback.style.opacity = '0';
                    feedback.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => {
                        if (feedback.parentNode) {
                            feedback.parentNode.removeChild(feedback);
                        }
                    }, 500);
                }, 3000);
            },

            criarBotaoVoltar: function(destino = 'dashboard') {
                return `
                    <div class="container-botoes">
                        <button class="btn" onclick="showTab('${destino}')">‚Ü©Ô∏è Voltar</button>
                        <div class="botoes-direita">
                            <button class="btn-atualizar" onclick="atualizarSistema()">üîÑ Atualizar Sistema</button>
                        </div>
                    </div>
                `;
            }
        };

        // ========== SISTEMA DE INTERFACE ==========
        const Interface = {
            inicializar: function() {
                this.criarDashboard();
                this.criarAbas();
                this.configurarEventListeners();
                atualizarEstatisticas();
            },

            criarDashboard: function() {
                // Stats
                document.getElementById('stats-container').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number" id="total-clientes">0</div>
                        <p>Clientes Cadastrados</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-processos">0</div>
                        <p>Total de Processos</p>
                    </div>
                `;

                // Processos por √°rea
                const areas = ['Trabalhista', 'C√≠vel', 'Consumidor', 'Previdenci√°rio', 'Fam√≠lia', 'Criminal', 'Outros'];
                document.getElementById('processos-container').innerHTML = areas.map(area => `
                    <div class="processo-card">
                        <div class="processo-number" id="processos-${area.toLowerCase()}">0</div>
                        <p>${area}</p>
                    </div>
                `).join('');

                // A√ß√µes r√°pidas
                document.getElementById('acoes-rapidas').innerHTML = `
                    <button class="btn" onclick="showTab('clientes')">üë§ Cadastrar Cliente</button>
                    <button class="btn" onclick="showTab('processos')">üìÅ Cadastrar Processo</button>
                    <button class="btn" onclick="showTab('andamento')">üìù Cadastrar Andamento Processual</button>
                    <button class="btn" onclick="showTab('consultas')">üîç Consultas</button>
                    <button class="btn" onclick="showTab('relatorios')">üìä Relat√≥rios</button>
                    <button class="btn" onclick="showTab('backups')">üíæ Backups</button>
                    <button class="btn btn-info" onclick="showTab('teses')">üìö Cadastro de Teses</button>
                    <button class="btn btn-warning" onclick="executarAutoReparo()">üõ†Ô∏è Sistema de Auto-Reparo</button>
                    <button class="btn btn-secondary" onclick="showTab('duvidas')">‚ùì D√∫vidas e Ajuda</button>
                `;
            },

            criarAbas: function() {
                const abas = [
                    this.criarAbaClientes(),
                    this.criarAbaProcessos(),
                    this.criarAbaAndamento(),
                    this.criarAbaConsultas(),
                    this.criarAbaRelatorios(),
                    this.criarAbaBackups(),
                    this.criarAbaTeses(),
                    this.criarAbaDuvidas()
                ];
                
                document.getElementById('abas-container').innerHTML = abas.join('');
            },

            criarAbaClientes: function() {
                return `
                    <div id="clientes" class="tab-content">
                        <div class="card">
                            <h3>üë§ Cadastro de Clientes</h3>
                            <div class="clientes-container">
                                <div>
                                    <div id="mensagem-cliente"></div>
                                    ${this.criarFormularioCliente()}
                                    <button class="btn btn-success" id="btn-salvar-cliente" onclick="salvarCliente()">üíæ Salvar Cliente</button>
                                    <div class="botoes-internos">
                                        <button class="btn" onclick="showTab('editar-cliente')">‚úèÔ∏è Editar Cliente</button>
                                        <button class="btn" onclick="showTab('processos')">üìÅ Cadastrar Processo</button>
                                    </div>
                                </div>
                                <div class="lista-clientes">
                                    <div class="total-clientes">
                                        <div class="numero" id="contador-clientes">0</div>
                                        <p>Clientes Cadastrados</p>
                                    </div>
                                    <div id="lista-clientes-realtime"></div>
                                </div>
                            </div>
                            ${Utils.criarBotaoVoltar()}
                        </div>
                    </div>
                    ${this.criarAbaEditarCliente()}
                `;
            },

            criarFormularioCliente: function() {
                return `
                    <div class="form-group">
                        <label>C√≥digo do Cliente (Autom√°tico):</label>
                        <input type="text" id="cliente-codigo" readonly style="background: #f0f0f0;">
                        <small>Gerado automaticamente pelo sistema</small>
                    </div>
                    <div class="form-group">
                        <label>Nome Completo *</label>
                        <input type="text" id="cliente-nome" placeholder="Nome completo do cliente" required>
                    </div>
                    <div class="form-group">
                        <label>Sexo</label>
                        <select id="cliente-sexo">
                            <option value="">Selecione</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Feminino">Feminino</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>CPF</label>
                        <input type="text" id="cliente-cpf" placeholder="000.000.000-00" oninput="Utils.formatarCPF(this)">
                    </div>
                    <div class="form-group">
                        <label>RG</label>
                        <input type="text" id="cliente-rg" placeholder="00.000.000-0" oninput="Utils.formatarRG(this)">
                    </div>
                    <div class="form-group">
                        <label>Endere√ßo Completo</label>
                        <input type="text" id="cliente-endereco" placeholder="Rua, n√∫mero, bairro, cidade">
                    </div>
                    <div class="form-group">
                        <label>Telefone</label>
                        <input type="text" id="cliente-telefone" placeholder="(11) 99999-9999">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="cliente-email" placeholder="cliente@email.com">
                    </div>
                    <div class="form-group">
                        <label>Observa√ß√µes</label>
                        <textarea id="cliente-observacoes" placeholder="Observa√ß√µes importantes..." rows="3"></textarea>
                    </div>
                `;
            },

            criarAbaEditarCliente: function() {
                return `
                    <div id="editar-cliente" class="tab-content">
                        <div class="card">
                            <h3>‚úèÔ∏è Editar Cliente</h3>
                            <div class="search-box">
                                <div class="form-group">
                                    <label>Buscar Cliente (C√≥digo ou CPF):</label>
                                    <input type="text" id="buscar-cliente-editar" placeholder="Digite c√≥digo ou CPF do cliente">
                                    <button class="btn" onclick="buscarClienteEditar()" style="margin-top: 10px;">üîç Buscar Cliente</button>
                                </div>
                            </div>
                            <div id="form-editar-cliente" style="display: none;">
                                ${this.criarFormularioCliente().replace(/cliente-/g, 'editar-').replace('id="editar-codigo"', 'id="editar-codigo" readonly style="background: #f0f0f0;"')}
                                <button class="btn btn-success" onclick="atualizarCliente()">üíæ Atualizar Cliente</button>
                            </div>
                            ${Utils.criarBotaoVoltar('clientes')}
                        </div>
                    </div>
                `;
            },

            criarAbaProcessos: function() {
                return `
                    <div id="processos" class="tab-content">
                        <div class="card">
                            <h3>üìÅ Cadastrar Processo</h3>
                            <div class="form-group">
                                <label>C√≥digo do Cliente *</label>
                                <input type="text" id="processo-cliente" placeholder="C√≥digo do cliente (Ex: 001)" required>
                            </div>
                            <div class="form-group">
                                <label>N√∫mero do Processo *</label>
                                <input type="text" id="processo-numero" placeholder="Ex: 2024.001.0001" required>
                            </div>
                            <div class="form-group">
                                <label>Tipo do Processo *</label>
                                <select id="processo-tipo" required>
                                    <option value="">Selecione o tipo</option>
                                    <option value="Trabalhista">Trabalhista</option>
                                    <option value="C√≠vel">C√≠vel</option>
                                    <option value="Consumidor">Consumidor</option>
                                    <option value="Previdenci√°rio">Previdenci√°rio</option>
                                    <option value="Fam√≠lia">Fam√≠lia</option>
                                    <option value="Criminal">Criminal</option>
                                    <option value="Outros">Outros</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Local do Processo</label>
                                <input type="text" id="processo-local" placeholder="Ex: F√≥rum Central">
                            </div>
                            <div class="form-group">
                                <label>Data de In√≠cio</label>
                                <input type="date" id="processo-data">
                            </div>
                            <div class="form-group">
                                <label>Resumo do Processo *</label>
                                <textarea id="processo-resumo" placeholder="Descreva detalhadamente o processo, situa√ß√£o atual, andamento, pr√≥ximos passos..." rows="5" required></textarea>
                            </div>
                            <button class="btn btn-success" onclick="salvarProcesso()">üíæ Salvar Processo</button>
                            ${Utils.criarBotaoVoltar()}
                        </div>
                    </div>
                `;
            },

            criarAbaAndamento: function() {
                return `
                    <div id="andamento" class="tab-content">
                        <div class="card">
                            <h3>üìù Cadastrar Andamento Processual</h3>
                            <div class="search-box">
                                <div class="form-group">
                                    <label>Buscar Cliente (C√≥digo ou CPF):</label>
                                    <input type="text" id="buscar-cliente-andamento" placeholder="Digite c√≥digo ou CPF do cliente">
                                    <button class="btn" onclick="buscarClienteAndamento()" style="margin-top: 10px;">üîç Buscar Cliente</button>
                                </div>
                            </div>
                            <div id="info-cliente-andamento" style="display: none;">
                                <div class="data-item">
                                    <h4>Cliente Encontrado:</h4>
                                    <p id="cliente-info"></p>
                                </div>
                                <div class="form-group">
                                    <label>Novo Andamento/Atualiza√ß√£o:</label>
                                    <textarea id="novo-andamento" placeholder="Descreva o novo andamento, atualiza√ß√µes, decis√µes judiciais, prazos, etc..." rows="6"></textarea>
                                </div>
                                <button class="btn btn-success" onclick="adicionarAndamento()">‚ûï Adicionar Andamento</button>
                            </div>
                            ${Utils.criarBotaoVoltar()}
                        </div>
                    </div>
                `;
            },

            criarAbaConsultas: function() {
                return `
                    <div id="consultas" class="tab-content">
                        <div class="card">
                            <h3>üîç Consultas</h3>
                            <div class="search-box">
                                <h4>üìã Consultar Clientes</h4>
                                <div class="form-group">
                                    <input type="text" id="consulta-cliente" placeholder="Digite c√≥digo, nome ou CPF...">
                                </div>
                                <button class="btn" onclick="consultarClientes()">üîç Buscar Clientes</button>
                                <button class="btn" onclick="listarTodosClientes()">üìÑ Listar Todos</button>
                            </div>
                            <div class="search-box">
                                <h4>üìÅ Consultar Processos</h4>
                                <div class="form-group">
                                    <input type="text" id="consulta-processo" placeholder="Digite n√∫mero, tipo ou cliente...">
                                </div>
                                <button class="btn" onclick="consultarProcessos()">üîç Buscar Processos</button>
                                <button class="btn" onclick="listarTodosProcessos()">üìÑ Listar Todos</button>
                                <button class="btn btn-warning" onclick="consultarAndamentoProcessual()">üìà Andamento Processual</button>
                            </div>
                            <div id="resultados-consulta"></div>
                            ${Utils.criarBotaoVoltar()}
                        </div>
                    </div>
                `;
            },

            criarAbaRelatorios: function() {
                return `
                    <div id="relatorios" class="tab-content">
                        <div class="card">
                            <h3>üìä Relat√≥rios</h3>
                            <button class="btn" onclick="gerarRelatorioClientesAlfabetico()">üë§ Clientes (Ordem Alfab√©tica)</button>
                            <button class="btn" onclick="gerarRelatorioClientesProcesso()">‚öñÔ∏è Clientes por Processo</button>
                            <div class="search-box">
                                <h4>üîç Relat√≥rio Cliente Espec√≠fico</h4>
                                <div class="form-group">
                                    <input type="text" id="relatorio-cliente-especifico" placeholder="Digite c√≥digo ou CPF do cliente">
                                </div>
                                <button class="btn" onclick="gerarRelatorioClienteEspecifico()">üìã Gerar Relat√≥rio</button>
                            </div>
                            <button class="btn" onclick="gerarRelatorioProcessosDetalhado()">üìÅ Processos Detalhados</button>
                            <button class="btn btn-warning" onclick="gerarRelatorioAndamentoGeral()">üìà Andamento Geral</button>
                            <div id="relatorio-conteudo"></div>
                            ${Utils.criarBotaoVoltar()}
                        </div>
                    </div>
                `;
            },

            criarAbaBackups: function() {
                return `
                    <div id="backups" class="tab-content">
                        <div class="card">
                            <h3>üíæ Sistema de Backups</h3>
                            <div class="card">
                                <h4>üì¶ Backup de Clientes e Processos</h4>
                                <p>Exporte todos os dados de clientes, processos e andamentos para um arquivo de backup.</p>
                                <button class="btn btn-success" onclick="exportBackupClientes()">üíæ Gerar Backup de Clientes</button>
                                <button class="btn btn-warning" onclick="importBackupClientes()">üì• Importar Backup de Clientes</button>
                            </div>
                            <div class="card">
                                <h4>üìö Backup de Teses Jur√≠dicas</h4>
                                <p>Exporte todas as teses jur√≠dicas cadastradas para um arquivo de backup separado.</p>
                                <button class="btn btn-success" onclick="exportBackupTeses()">üíæ Gerar Backup de Teses</button>
                                <button class="btn btn-warning" onclick="importBackupTeses()">üì• Importar Backup de Teses</button>
                            </div>
                            ${Utils.criarBotaoVoltar()}
                        </div>
                    </div>
                `;
            },

            criarAbaTeses: function() {
                return `
                    <div id="teses" class="tab-content">
                        <div class="card">
                            <h3>üìö Cadastro de Teses Jur√≠dicas</h3>
                            <div class="btn-row">
                                <button class="btn btn-danger" onclick="showTab('consultar-teses')">üîç Consultar Teses Cadastradas</button>
                            </div>
                            <div class="card">
                                <h4>‚ûï Cadastrar Nova Tese</h4>
                                <div class="form-group">
                                    <label>Nome da Tese:</label>
                                    <input type="text" id="nova-tese-nome" placeholder="Digite o nome da nova tese">
                                </div>
                                <div class="form-group">
                                    <label>Tipo de Tese:</label>
                                    <select id="nova-tese-tipo">
                                        <option value="inicial">Tese para Inicial</option>
                                        <option value="impugnacao">Tese para Impugna√ß√£o</option>
                                        <option value="recurso">Tese para Recurso</option>
                                    </select>
                                </div>
                                <button class="btn btn-success" onclick="criarNovaTese()">‚ûï Criar Nova Tese</button>
                            </div>
                            <div class="teses-grid">
                                ${this.criarTipoTese('inicial', 'üìù Teses para Inicial')}
                                ${this.criarTipoTese('impugnacao', '‚öñÔ∏è Teses para Impugna√ß√£o')}
                                ${this.criarTipoTese('recurso', 'üìÑ Teses para Recurso')}
                            </div>
                            ${Utils.criarBotaoVoltar()}
                        </div>
                    </div>
                    ${this.criarAbaConsultarTeses()}
                `;
            },

            criarTipoTese: function(tipo, titulo) {
                return `
                    <div class="tese-card">
                        <h4>${titulo}</h4>
                        <div class="form-group">
                            <label>Selecione a Tese:</label>
                            <select id="tese-${tipo}" onchange="mostrarFormularioTese('${tipo}')">
                                <option value="">Selecione uma tese</option>
                            </select>
                        </div>
                        <div id="formulario-tese-${tipo}" class="tese-form" style="display: none;">
                            <div class="form-group">
                                <label>Conte√∫do da Tese:</label>
                                <textarea id="conteudo-tese-${tipo}" rows="8" placeholder="Digite ou cole o conte√∫do da tese aqui..."></textarea>
                            </div>
                            <div class="btn-row">
                                <button class="btn btn-success btn-small" onclick="salvarTese('${tipo}')">üíæ Salvar Tese</button>
                                <button class="btn btn-info btn-small" onclick="editarTese('${tipo}')">‚úèÔ∏è Editar Tese</button>
                                <button class="btn btn-danger btn-small" onclick="excluirTese('${tipo}')">üóëÔ∏è Excluir Tese</button>
                            </div>
                        </div>
                    </div>
                `;
            },

            criarAbaConsultarTeses: function() {
                return `
                    <div id="consultar-teses" class="tab-content">
                        <div class="card">
                            <h3>üîç Consultar Teses Cadastradas</h3>
                            <div class="tese-selecao">
                                <div class="form-group">
                                    <label>Selecione o Tipo de Tese:</label>
                                    <select id="tipo-tese-consulta" onchange="carregarTesesParaConsulta()">
                                        <option value="">Selecione o tipo</option>
                                        <option value="inicial">Tese para Inicial</option>
                                        <option value="impugnacao">Tese para Impugna√ß√£o</option>
                                        <option value="recurso">Tese para Recurso</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Selecione a Tese:</label>
                                    <select id="tese-consulta" onchange="mostrarTeseSelecionada()">
                                        <option value="">Selecione uma tese</option>
                                    </select>
                                </div>
                            </div>
                            <div id="tese-exibicao" style="display: none;">
                                <div class="card">
                                    <h4 id="titulo-tese"></h4>
                                    <div class="data-item">
                                        <pre id="conteudo-tese-consulta" style="white-space: pre-wrap; font-family: inherit;"></pre>
                                    </div>
                                    <button class="btn btn-success" onclick="copiarTeseConsulta()">üìã Copiar Tese</button>
                                    <button class="print-btn" onclick="imprimirTese()">üñ®Ô∏è Imprimir Tese</button>
                                </div>
                            </div>
                            ${Utils.criarBotaoVoltar('teses')}
                        </div>
                    </div>
                `;
            },

            criarAbaDuvidas: function() {
                return `
                    <div id="duvidas" class="tab-content">
                        <div class="card">
                            <h3>‚ùì D√∫vidas e Ajuda</h3>
                            <p>Compartilhe suas d√∫vidas e ajude outros advogados da equipe.</p>
                            <div class="card">
                                <h4>‚ûï Nova D√∫vida</h4>
                                <div class="form-group">
                                    <label>Seu Nome:</label>
                                    <input type="text" id="duvida-nome" placeholder="Digite seu nome">
                                </div>
                                <div class="form-group">
                                    <label>Sua Cidade:</label>
                                    <input type="text" id="duvida-cidade" placeholder="Digite sua cidade">
                                </div>
                                <div class="form-group">
                                    <label>D√∫vida na √°rea de:</label>
                                    <select id="duvida-area">
                                        <option value="">Selecione a √°rea</option>
                                        <option value="Trabalhista">Trabalhista</option>
                                        <option value="C√≠vel">C√≠vel</option>
                                        <option value="Previdenci√°rio">Previdenci√°rio</option>
                                        <option value="Criminal">Criminal</option>
                                        <option value="Consumidor">Consumidor</option>
                                        <option value="Outras">Outras</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Resumo da D√∫vida (m√°x. 200 caracteres):</label>
                                    <textarea id="duvida-resumo" rows="2" placeholder="Digite um resumo breve da sua d√∫vida (m√°ximo 200 caracteres)" maxlength="200" oninput="atualizarContadorResumo()"></textarea>
                                    <small id="contador-resumo">0/200 caracteres</small>
                                </div>
                                <div class="form-group">
                                    <label>Descri√ß√£o Completa da D√∫vida:</label>
                                    <textarea id="duvida-descricao" rows="6" placeholder="Descreva sua d√∫vida em detalhes..."></textarea>
                                </div>
                                <button class="btn btn-success" onclick="enviarDuvida()">üì§ Enviar Duvida</button>
                            </div>
                            <div class="filtro-duvidas">
                                <h4>üîç Filtrar D√∫vidas por √Årea</h4>
                                <div class="filtro-botoes">
                                    <button class="filtro-btn ativo" onclick="filtrarDuvidas('todas')">Todas</button>
                                    <button class="filtro-btn" onclick="filtrarDuvidas('Trabalhista')">Trabalhista</button>
                                    <button class="filtro-btn" onclick="filtrarDuvidas('C√≠vel')">C√≠vel</button>
                                    <button class="filtro-btn" onclick="filtrarDuvidas('Previdenci√°rio')">Previdenci√°rio</button>
                                    <button class="filtro-btn" onclick="filtrarDuvidas('Criminal')">Criminal</button>
                                    <button class="filtro-btn" onclick="filtrarDuvidas('Consumidor')">Consumidor</button>
                                    <button class="filtro-btn" onclick="filtrarDuvidas('Outras')">Outras</button>
                                </div>
                            </div>
                            <div id="lista-duvidas"></div>
                            ${Utils.criarBotaoVoltar()}
                        </div>
                    </div>
                `;
            },

            configurarEventListeners: function() {
                document.getElementById('backup-file-clientes').addEventListener('change', (event) => processarBackup(event, 'clientes'));
                document.getElementById('backup-file-teses').addEventListener('change', (event) => processarBackup(event, 'teses'));
            }
        };

        // ========== FUN√á√ïES PRINCIPAIS ==========
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            // Inicializa√ß√µes espec√≠ficas de cada aba
            const inicializacoes = {
                'clientes': () => {
                    limparFormularioCliente();
                    document.getElementById('cliente-codigo').value = DB.gerarCodigoCliente();
                    document.getElementById('btn-salvar-cliente').disabled = false;
                    document.getElementById('mensagem-cliente').innerHTML = '';
                    atualizarListaClientesRealtime();
                },
                'teses': () => carregarTeses(),
                'consultar-teses': () => {
                    document.getElementById('tese-exibicao').style.display = 'none';
                },
                'duvidas': () => carregarDuvidas(),
                'processos': () => {
                    document.getElementById('processo-data').valueAsDate = new Date();
                }
            };
            
            if (inicializacoes[tabName]) {
                inicializacoes[tabName]();
            }
            
            atualizarEstatisticas();
        }

        function limparFormularioCliente() {
            document.getElementById('cliente-nome').value = '';
            document.getElementById('cliente-sexo').value = '';
            document.getElementById('cliente-cpf').value = '';
            document.getElementById('cliente-rg').value = '';
            document.getElementById('cliente-endereco').value = '';
            document.getElementById('cliente-telefone').value = '';
            document.getElementById('cliente-email').value = '';
            document.getElementById('cliente-observacoes').value = '';
        }

        function salvarCliente() {
            const codigo = document.getElementById('cliente-codigo').value;
            const nome = document.getElementById('cliente-nome').value;
            
            if (!nome) {
                Utils.mostrarFeedback('Por favor, preencha o nome do cliente', 'danger');
                return;
            }
            
            const cliente = {
                codigo: codigo,
                nome: nome,
                sexo: document.getElementById('cliente-sexo').value,
                cpf: document.getElementById('cliente-cpf').value,
                rg: document.getElementById('cliente-rg').value,
                endereco: document.getElementById('cliente-endereco').value,
                telefone: document.getElementById('cliente-telefone').value,
                email: document.getElementById('cliente-email').value,
                observacoes: document.getElementById('cliente-observacoes').value,
                dataCadastro: new Date().toISOString()
            };
            
            DB.clientes.push(cliente);
            DB.salvar();
            
            Utils.mostrarFeedback(`Cliente ${codigo} - ${nome} cadastrado com sucesso!`);
            limparFormularioCliente();
            document.getElementById('cliente-codigo').value = DB.gerarCodigoCliente();
        }

        function atualizarListaClientesRealtime() {
            const lista = document.getElementById('lista-clientes-realtime');
            const contador = document.getElementById('contador-clientes');
            
            if (!lista) return;
            
            contador.textContent = DB.clientes.length;
            
            if (DB.clientes.length === 0) {
                lista.innerHTML = '<div class="alert alert-danger">Nenhum cliente cadastrado ainda.</div>';
                return;
            }
            
            lista.innerHTML = DB.clientes.map(cliente => `
                <div class="cliente-item">
                    <div class="cliente-header">
                        <span class="cliente-codigo">${cliente.codigo}</span>
                        <span>${cliente.nome}</span>
                    </div>
                    <div>
                        <strong>CPF:</strong> ${cliente.cpf || 'N√£o informado'} | 
                        <strong>Telefone:</strong> ${cliente.telefone || 'N√£o informado'}
                    </div>
                </div>
            `).join('');
        }

        function atualizarEstatisticas() {
            // Atualizar totais
            document.getElementById('total-clientes').textContent = DB.clientes.length;
            document.getElementById('total-processos').textContent = DB.processos.length;
            
            // Atualizar processos por √°rea
            const areas = ['trabalhista', 'c√≠vel', 'consumidor', 'previdenci√°rio', 'fam√≠lia', 'criminal', 'outros'];
            areas.forEach(area => {
                const count = DB.processos.filter(p => p.tipo.toLowerCase() === area).length;
                const element = document.getElementById(`processos-${area}`);
                if (element) element.textContent = count;
            });
        }

        function buscarClienteEditar() {
            const busca = document.getElementById('buscar-cliente-editar').value.toLowerCase();
            const cliente = DB.clientes.find(c => 
                c.codigo === busca || c.cpf.replace(/\D/g, '') === busca.replace(/\D/g, '')
            );
            
            if (cliente) {
                document.getElementById('form-editar-cliente').style.display = 'block';
                document.getElementById('editar-codigo').value = cliente.codigo;
                document.getElementById('editar-nome').value = cliente.nome;
                document.getElementById('editar-sexo').value = cliente.sexo;
                document.getElementById('editar-cpf').value = cliente.cpf;
                document.getElementById('editar-rg').value = cliente.rg;
                document.getElementById('editar-endereco').value = cliente.endereco;
                document.getElementById('editar-telefone').value = cliente.telefone;
                document.getElementById('editar-email').value = cliente.email;
                document.getElementById('editar-observacoes').value = cliente.observacoes;
                
                Utils.mostrarFeedback(`Cliente ${cliente.codigo} encontrado!`);
            } else {
                Utils.mostrarFeedback('Cliente n√£o encontrado!', 'danger');
            }
        }

        function atualizarCliente() {
            const codigo = document.getElementById('editar-codigo').value;
            const index = DB.clientes.findIndex(c => c.codigo === codigo);
            
            if (index !== -1) {
                DB.clientes[index] = {
                    codigo: codigo,
                    nome: document.getElementById('editar-nome').value,
                    sexo: document.getElementById('editar-sexo').value,
                    cpf: document.getElementById('editar-cpf').value,
                    rg: document.getElementById('editar-rg').value,
                    endereco: document.getElementById('editar-endereco').value,
                    telefone: document.getElementById('editar-telefone').value,
                    email: document.getElementById('editar-email').value,
                    observacoes: document.getElementById('editar-observacoes').value,
                    dataCadastro: DB.clientes[index].dataCadastro
                };
                
                DB.salvar();
                Utils.mostrarFeedback(`Cliente ${codigo} atualizado com sucesso!`);
                document.getElementById('form-editar-cliente').style.display = 'none';
            }
        }

        function salvarProcesso() {
            const clienteCodigo = document.getElementById('processo-cliente').value;
            const numero = document.getElementById('processo-numero').value;
            const tipo = document.getElementById('processo-tipo').value;
            const resumo = document.getElementById('processo-resumo').value;
            
            if (!clienteCodigo || !numero || !tipo || !resumo) {
                Utils.mostrarFeedback('Por favor, preencha todos os campos obrigat√≥rios', 'danger');
                return;
            }
            
            const cliente = DB.clientes.find(c => c.codigo === clienteCodigo);
            if (!cliente) {
                Utils.mostrarFeedback('Cliente n√£o encontrado! Verifique o c√≥digo.', 'danger');
                return;
            }
            
            const processo = {
                id: Date.now().toString(),
                clienteCodigo: clienteCodigo,
                numero: numero,
                tipo: tipo,
                local: document.getElementById('processo-local').value,
                data: document.getElementById('processo-data').value,
                resumo: resumo,
                dataCadastro: new Date().toISOString()
            };
            
            DB.processos.push(processo);
            DB.salvar();
            
            Utils.mostrarFeedback(`Processo ${numero} cadastrado com sucesso para o cliente ${clienteCodigo}!`);
            
            // Limpar formul√°rio
            document.getElementById('processo-cliente').value = '';
            document.getElementById('processo-numero').value = '';
            document.getElementById('processo-tipo').value = '';
            document.getElementById('processo-local').value = '';
            document.getElementById('processo-data').valueAsDate = new Date();
            document.getElementById('processo-resumo').value = '';
        }

        function buscarClienteAndamento() {
            const busca = document.getElementById('buscar-cliente-andamento').value.toLowerCase();
            const cliente = DB.clientes.find(c => 
                c.codigo === busca || c.cpf.replace(/\D/g, '') === busca.replace(/\D/g, '')
            );
            
            if (cliente) {
                document.getElementById('info-cliente-andamento').style.display = 'block';
                document.getElementById('cliente-info').innerHTML = `
                    <strong>${cliente.codigo} - ${cliente.nome}</strong><br>
                    CPF: ${cliente.cpf || 'N√£o informado'} | Telefone: ${cliente.telefone || 'N√£o informado'}
                `;
                
                Utils.mostrarFeedback(`Cliente ${cliente.codigo} encontrado!`);
            } else {
                Utils.mostrarFeedback('Cliente n√£o encontrado!', 'danger');
            }
        }

        function adicionarAndamento() {
            const busca = document.getElementById('buscar-cliente-andamento').value;
            const cliente = DB.clientes.find(c => 
                c.codigo === busca || c.cpf.replace(/\D/g, '') === busca.replace(/\D/g, '')
            );
            
            if (!cliente) {
                Utils.mostrarFeedback('Cliente n√£o encontrado!', 'danger');
                return;
            }
            
            const andamentoTexto = document.getElementById('novo-andamento').value;
            if (!andamentoTexto) {
                Utils.mostrarFeedback('Por favor, descreva o andamento', 'danger');
                return;
            }
            
            const andamento = {
                id: Date.now().toString(),
                clienteCodigo: cliente.codigo,
                data: new Date().toISOString(),
                descricao: andamentoTexto
            };
            
            DB.andamentos.push(andamento);
            DB.salvar();
            
            Utils.mostrarFeedback(`Andamento adicionado para o cliente ${cliente.codigo}!`);
            document.getElementById('novo-andamento').value = '';
        }

        function consultarClientes() {
            const termo = document.getElementById('consulta-cliente').value.toLowerCase();
            const resultados = DB.clientes.filter(cliente => 
                cliente.codigo.toLowerCase().includes(termo) ||
                cliente.nome.toLowerCase().includes(termo) ||
                cliente.cpf.toLowerCase().includes(termo)
            );
            
            exibirResultadosConsulta(resultados, 'clientes');
        }

        function listarTodosClientes() {
            exibirResultadosConsulta(DB.clientes, 'clientes');
        }

        function consultarProcessos() {
            const termo = document.getElementById('consulta-processo').value.toLowerCase();
            const resultados = DB.processos.filter(processo => 
                processo.numero.toLowerCase().includes(termo) ||
                processo.tipo.toLowerCase().includes(termo) ||
                processo.clienteCodigo.toLowerCase().includes(termo)
            );
            
            exibirResultadosConsulta(resultados, 'processos');
        }

        function listarTodosProcessos() {
            exibirResultadosConsulta(DB.processos, 'processos');
        }

        function exibirResultadosConsulta(dados, tipo) {
            const container = document.getElementById('resultados-consulta');
            
            if (dados.length === 0) {
                container.innerHTML = '<div class="alert alert-danger">Nenhum resultado encontrado.</div>';
                return;
            }
            
            if (tipo === 'clientes') {
                container.innerHTML = `
                    <h4>üìã Resultados da Consulta (${dados.length} clientes)</h4>
                    ${dados.map(cliente => `
                        <div class="data-item">
                            <div class="cliente-header">
                                <span class="cliente-codigo">${cliente.codigo}</span>
                                <span>${cliente.nome}</span>
                            </div>
                            <div>
                                <strong>CPF:</strong> ${cliente.cpf || 'N√£o informado'} | 
                                <strong>Telefone:</strong> ${cliente.telefone || 'N√£o informado'} |
                                <strong>Email:</strong> ${cliente.email || 'N√£o informado'}
                            </div>
                            <div><strong>Endere√ßo:</strong> ${cliente.endereco || 'N√£o informado'}</div>
                            ${cliente.observacoes ? `<div><strong>Observa√ß√µes:</strong> ${cliente.observacoes}</div>` : ''}
                        </div>
                    `).join('')}
                `;
            } else if (tipo === 'processos') {
                container.innerHTML = `
                    <h4>üìÅ Resultados da Consulta (${dados.length} processos)</h4>
                    ${dados.map(processo => {
                        const cliente = DB.clientes.find(c => c.codigo === processo.clienteCodigo);
                        return `
                            <div class="data-item">
                                <div class="cliente-header">
                                    <span class="cliente-codigo">${processo.numero}</span>
                                    <span>${processo.tipo}</span>
                                </div>
                                <div>
                                    <strong>Cliente:</strong> ${cliente ? `${cliente.codigo} - ${cliente.nome}` : 'N√£o encontrado'} | 
                                    <strong>Local:</strong> ${processo.local || 'N√£o informado'} |
                                    <strong>Data:</strong> ${processo.data || 'N√£o informada'}
                                </div>
                                <div><strong>Resumo:</strong> ${processo.resumo}</div>
                            </div>
                        `;
                    }).join('')}
                `;
            }
        }

        function consultarAndamentoProcessual() {
            const container = document.getElementById('resultados-consulta');
            const andamentosComCliente = DB.andamentos.map(andamento => {
                const cliente = DB.clientes.find(c => c.codigo === andamento.clienteCodigo);
                return {
                    ...andamento,
                    clienteNome: cliente ? cliente.nome : 'Cliente n√£o encontrado'
                };
            });
            
            if (andamentosComCliente.length === 0) {
                container.innerHTML = '<div class="alert alert-danger">Nenhum andamento cadastrado.</div>';
                return;
            }
            
            container.innerHTML = `
                <h4>üìà Andamento Processual (${andamentosComCliente.length} registros)</h4>
                ${andamentosComCliente.map(andamento => `
                    <div class="data-item">
                        <div class="cliente-header">
                            <span class="cliente-codigo">${andamento.clienteCodigo}</span>
                            <span>${andamento.clienteNome}</span>
                        </div>
                        <div><strong>Data:</strong> ${new Date(andamento.data).toLocaleString()}</div>
                        <div><strong>Andamento:</strong> ${andamento.descricao}</div>
                    </div>
                `).join('')}
            `;
        }

        function gerarRelatorioClientesAlfabetico() {
            const clientesOrdenados = [...DB.clientes].sort((a, b) => a.nome.localeCompare(b.nome));
            exibirRelatorio(clientesOrdenados, 'clientes-alfabetico');
        }

        function gerarRelatorioClientesProcesso() {
            const clientesComProcessos = DB.clientes.map(cliente => {
                const processos = DB.processos.filter(p => p.clienteCodigo === cliente.codigo);
                return {
                    ...cliente,
                    quantidadeProcessos: processos.length
                };
            }).filter(cliente => cliente.quantidadeProcessos > 0)
              .sort((a, b) => b.quantidadeProcessos - a.quantidadeProcessos);
            
            exibirRelatorio(clientesComProcessos, 'clientes-processo');
        }

        function gerarRelatorioClienteEspecifico() {
            const busca = document.getElementById('relatorio-cliente-especifico').value;
            const cliente = DB.clientes.find(c => 
                c.codigo === busca || c.cpf.replace(/\D/g, '') === busca.replace(/\D/g, '')
            );
            
            if (!cliente) {
                Utils.mostrarFeedback('Cliente n√£o encontrado!', 'danger');
                return;
            }
            
            const processos = DB.processos.filter(p => p.clienteCodigo === cliente.codigo);
            const andamentos = DB.andamentos.filter(a => a.clienteCodigo === cliente.codigo);
            
            const relatorio = {
                cliente: cliente,
                processos: processos,
                andamentos: andamentos
            };
            
            exibirRelatorio(relatorio, 'cliente-especifico');
        }

        function gerarRelatorioProcessosDetalhado() {
            const processosComCliente = DB.processos.map(processo => {
                const cliente = DB.clientes.find(c => c.codigo === processo.clienteCodigo);
                return {
                    ...processo,
                    clienteNome: cliente ? cliente.nome : 'Cliente n√£o encontrado'
                };
            });
            
            exibirRelatorio(processosComCliente, 'processos-detalhados');
        }

        function gerarRelatorioAndamentoGeral() {
            const andamentosComCliente = DB.andamentos.map(andamento => {
                const cliente = DB.clientes.find(c => c.codigo === andamento.clienteCodigo);
                return {
                    ...andamento,
                    clienteNome: cliente ? cliente.nome : 'Cliente n√£o encontrado'
                };
            });
            
            exibirRelatorio(andamentosComCliente, 'andamento-geral');
        }

        function exibirRelatorio(dados, tipo) {
            const container = document.getElementById('relatorio-conteudo');
            let html = '<div class="card"><h4>üìä Relat√≥rio Gerado</h4>';
            
            switch(tipo) {
                case 'clientes-alfabetico':
                    html += `
                        <h5>üë§ Clientes em Ordem Alfab√©tica (${dados.length})</h5>
                        ${dados.map(cliente => `
                            <div class="data-item">
                                <strong>${cliente.codigo} - ${cliente.nome}</strong><br>
                                CPF: ${cliente.cpf || 'N√£o informado'} | Telefone: ${cliente.telefone || 'N√£o informado'}<br>
                                Email: ${cliente.email || 'N√£o informado'} | Endere√ßo: ${cliente.endereco || 'N√£o informado'}
                            </div>
                        `).join('')}
                    `;
                    break;
                    
                case 'clientes-processo':
                    html += `
                        <h5>‚öñÔ∏è Clientes por Quantidade de Processos (${dados.length})</h5>
                        ${dados.map(cliente => `
                            <div class="data-item">
                                <strong>${cliente.codigo} - ${cliente.nome}</strong><br>
                                Processos: ${cliente.quantidadeProcessos}<br>
                                CPF: ${cliente.cpf || 'N√£o informado'} | Telefone: ${cliente.telefone || 'N√£o informado'}
                            </div>
                        `).join('')}
                    `;
                    break;
                    
                case 'cliente-especifico':
                    const { cliente, processos, andamentos } = dados;
                    html += `
                        <h5>üìã Relat√≥rio do Cliente ${cliente.codigo} - ${cliente.nome}</h5>
                        <div class="data-item">
                            <h6>üìù Dados Pessoais</h6>
                            <strong>CPF:</strong> ${cliente.cpf || 'N√£o informado'}<br>
                            <strong>RG:</strong> ${cliente.rg || 'N√£o informado'}<br>
                            <strong>Sexo:</strong> ${cliente.sexo || 'N√£o informado'}<br>
                            <strong>Telefone:</strong> ${cliente.telefone || 'N√£o informado'}<br>
                            <strong>Email:</strong> ${cliente.email || 'N√£o informado'}<br>
                            <strong>Endere√ßo:</strong> ${cliente.endereco || 'N√£o informado'}<br>
                            <strong>Observa√ß√µes:</strong> ${cliente.observacoes || 'Nenhuma'}
                        </div>
                        
                        <div class="data-item">
                            <h6>üìÅ Processos (${processos.length})</h6>
                            ${processos.length > 0 ? processos.map(processo => `
                                <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                                    <strong>${processo.numero} - ${processo.tipo}</strong><br>
                                    <strong>Local:</strong> ${processo.local || 'N√£o informado'}<br>
                                    <strong>Data:</strong> ${processo.data || 'N√£o informada'}<br>
                                    <strong>Resumo:</strong> ${processo.resumo}
                                </div>
                            `).join('') : 'Nenhum processo cadastrado.'}
                        </div>
                        
                        <div class="data-item">
                            <h6>üìà Andamentos (${andamentos.length})</h6>
                            ${andamentos.length > 0 ? andamentos.map(andamento => `
                                <div style="margin: 10px 0; padding: 10px; background: #e3f2fd; border-radius: 5px;">
                                    <strong>${new Date(andamento.data).toLocaleString()}</strong><br>
                                    ${andamento.descricao}
                                </div>
                            `).join('') : 'Nenhum andamento cadastrado.'}
                        </div>
                    `;
                    break;
                    
                case 'processos-detalhados':
                    html += `
                        <h5>üìÅ Processos Detalhados (${dados.length})</h5>
                        ${dados.map(processo => `
                            <div class="data-item">
                                <strong>${processo.numero} - ${processo.tipo}</strong><br>
                                <strong>Cliente:</strong> ${processo.clienteNome} (${processo.clienteCodigo})<br>
                                <strong>Local:</strong> ${processo.local || 'N√£o informado'}<br>
                                <strong>Data:</strong> ${processo.data || 'N√£o informada'}<br>
                                <strong>Resumo:</strong> ${processo.resumo}
                            </div>
                        `).join('')}
                    `;
                    break;
                    
                case 'andamento-geral':
                    html += `
                        <h5>üìà Andamento Geral (${dados.length})</h5>
                        ${dados.map(andamento => `
                            <div class="data-item">
                                <strong>${andamento.clienteCodigo} - ${andamento.clienteNome}</strong><br>
                                <strong>Data:</strong> ${new Date(andamento.data).toLocaleString()}<br>
                                <strong>Andamento:</strong> ${andamento.descricao}
                            </div>
                        `).join('')}
                    `;
                    break;
            }
            
            html += '<button class="print-btn" onclick="window.print()">üñ®Ô∏è Imprimir Relat√≥rio</button></div>';
            container.innerHTML = html;
        }

        function exportBackupClientes() {
            const backup = {
                clientes: DB.clientes,
                processos: DB.processos,
                andamentos: DB.andamentos,
                dataBackup: new Date().toISOString(),
                versao: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-clientes-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            Utils.mostrarFeedback('Backup de clientes exportado com sucesso!');
        }

        function importBackupClientes() {
            document.getElementById('backup-file-clientes').click();
        }

        function exportBackupTeses() {
            const backup = {
                teses: DB.teses,
                dataBackup: new Date().toISOString(),
                versao: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-teses-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            Utils.mostrarFeedback('Backup de teses exportado com sucesso!');
        }

        function importBackupTeses() {
            document.getElementById('backup-file-teses').click();
        }

        function processarBackup(event, tipo) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    if (tipo === 'clientes') {
                        if (backup.clientes) DB.clientes = backup.clientes;
                        if (backup.processos) DB.processos = backup.processos;
                        if (backup.andamentos) DB.andamentos = backup.andamentos;
                        Utils.mostrarFeedback('Backup de clientes importado com sucesso!');
                    } else if (tipo === 'teses') {
                        if (backup.teses) DB.teses = backup.teses;
                        Utils.mostrarFeedback('Backup de teses importado com sucesso!');
                    }
                    
                    DB.salvar();
                    event.target.value = ''; // Reset do input
                } catch (error) {
                    Utils.mostrarFeedback('Erro ao importar backup. Arquivo inv√°lido.', 'danger');
                    console.error('Erro ao importar backup:', error);
                }
            };
            reader.readAsText(file);
        }

        function carregarTeses() {
            // Carregar teses nos selects
            ['inicial', 'impugnacao', 'recurso'].forEach(tipo => {
                const select = document.getElementById(`tese-${tipo}`);
                if (select) {
                    select.innerHTML = '<option value="">Selecione uma tese</option>' +
                        Object.keys(DB.teses[tipo] || {}).map(nome => 
                            `<option value="${nome}">${nome}</option>`
                        ).join('');
                }
            });
        }

        function mostrarFormularioTese(tipo) {
            const select = document.getElementById(`tese-${tipo}`);
            const formulario = document.getElementById(`formulario-tese-${tipo}`);
            const textarea = document.getElementById(`conteudo-tese-${tipo}`);
            
            if (select.value) {
                formulario.style.display = 'block';
                textarea.value = DB.teses[tipo][select.value] || '';
            } else {
                formulario.style.display = 'none';
            }
        }

        function salvarTese(tipo) {
            const select = document.getElementById(`tese-${tipo}`);
            const textarea = document.getElementById(`conteudo-tese-${tipo}`);
            
            if (!select.value) {
                Utils.mostrarFeedback('Selecione uma tese para salvar', 'danger');
                return;
            }
            
            if (!DB.teses[tipo]) DB.teses[tipo] = {};
            DB.teses[tipo][select.value] = textarea.value;
            DB.salvar();
            
            Utils.mostrarFeedback(`Tese "${select.value}" salva com sucesso!`);
        }

        function editarTese(tipo) {
            const select = document.getElementById(`tese-${tipo}`);
            const textarea = document.getElementById(`conteudo-tese-${tipo}`);
            
            if (!select.value) {
                Utils.mostrarFeedback('Selecione uma tese para editar', 'danger');
                return;
            }
            
            textarea.value = DB.teses[tipo][select.value] || '';
            textarea.focus();
        }

        function excluirTese(tipo) {
            const select = document.getElementById(`tese-${tipo}`);
            
            if (!select.value) {
                Utils.mostrarFeedback('Selecione uma tese para excluir', 'danger');
                return;
            }
            
            if (confirm(`Tem certeza que deseja excluir a tese "${select.value}"?`)) {
                delete DB.teses[tipo][select.value];
                DB.salvar();
                carregarTeses();
                document.getElementById(`formulario-tese-${tipo}`).style.display = 'none';
                Utils.mostrarFeedback(`Tese "${select.value}" exclu√≠da com sucesso!`);
            }
        }

        function criarNovaTese() {
            const nome = document.getElementById('nova-tese-nome').value;
            const tipo = document.getElementById('nova-tese-tipo').value;
            
            if (!nome) {
                Utils.mostrarFeedback('Digite o nome da nova tese', 'danger');
                return;
            }
            
            if (!DB.teses[tipo]) DB.teses[tipo] = {};
            
            if (DB.teses[tipo][nome]) {
                Utils.mostrarFeedback('J√° existe uma tese com este nome', 'danger');
                return;
            }
            
            DB.teses[tipo][nome] = '';
            DB.salvar();
            carregarTeses();
            
            // Selecionar a nova tese
            document.getElementById(`tese-${tipo}`).value = nome;
            mostrarFormularioTese(tipo);
            
            document.getElementById('nova-tese-nome').value = '';
            Utils.mostrarFeedback(`Nova tese "${nome}" criada com sucesso!`);
        }

        function carregarTesesParaConsulta() {
            const tipo = document.getElementById('tipo-tese-consulta').value;
            const select = document.getElementById('tese-consulta');
            
            select.innerHTML = '<option value="">Selecione uma tese</option>';
            
            if (tipo && DB.teses[tipo]) {
                Object.keys(DB.teses[tipo]).forEach(nome => {
                    select.innerHTML += `<option value="${nome}">${nome}</option>`;
                });
            }
        }

        function mostrarTeseSelecionada() {
            const tipo = document.getElementById('tipo-tese-consulta').value;
            const nome = document.getElementById('tese-consulta').value;
            const container = document.getElementById('tese-exibicao');
            
            if (tipo && nome && DB.teses[tipo] && DB.teses[tipo][nome]) {
                document.getElementById('titulo-tese').textContent = nome;
                document.getElementById('conteudo-tese-consulta').textContent = DB.teses[tipo][nome];
                container.style.display = 'block';
            } else {
                container.style.display = 'none';
            }
        }

        function copiarTeseConsulta() {
            const conteudo = document.getElementById('conteudo-tese-consulta').textContent;
            navigator.clipboard.writeText(conteudo).then(() => {
                Utils.mostrarFeedback('Tese copiada para a √°rea de transfer√™ncia!');
            });
        }

        function imprimirTese() {
            window.print();
        }

        function carregarDuvidas() {
            const container = document.getElementById('lista-duvidas');
            if (!container) return;
            
            if (DB.duvidas.length === 0) {
                container.innerHTML = '<div class="alert alert-info">Nenhuma d√∫vida cadastrada ainda.</div>';
                return;
            }
            
            container.innerHTML = DB.duvidas.map((duvida, index) => `
                <div class="lista-duvidas-item" onclick="toggleDuvida(${index})">
                    <div class="lista-duvidas-header">
                        <div>
                            <div class="duvida-resumo">${duvida.resumo}</div>
                            <div class="duvida-info">
                                <span>Por: ${duvida.nome} (${duvida.cidade})</span>
                                <span>${new Date(duvida.data).toLocaleString()}</span>
                            </div>
                        </div>
                        <div>
                            <span class="duvida-area">${duvida.area}</span>
                            <button class="btn-excluir-duvida" onclick="event.stopPropagation(); excluirDuvida(${index})">Excluir</button>
                        </div>
                    </div>
                    <div class="duvida-expandida" id="duvida-expandida-${index}">
                        <div><strong>Descri√ß√£o completa:</strong> ${duvida.descricao}</div>
                        ${duvida.respostas && duvida.respostas.length > 0 ? `
                            <div style="margin-top: 15px;">
                                <strong>Respostas (${duvida.respostas.length}):</strong>
                                ${duvida.respostas.map(resposta => `
                                    <div class="resposta-item">
                                        <strong>${resposta.autor} (${new Date(resposta.data).toLocaleString()}):</strong><br>
                                        ${resposta.conteudo}
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<div style="margin-top: 10px; color: #6c757d;">Nenhuma resposta ainda.</div>'}
                        <div class="form-resposta">
                            <div class="form-group">
                                <label>Sua Resposta:</label>
                                <textarea id="resposta-${index}" rows="3" placeholder="Digite sua resposta aqui..."></textarea>
                            </div>
                            <button class="btn btn-small" onclick="enviarResposta(${index})">üì§ Enviar Resposta</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleDuvida(index) {
            const expandida = document.getElementById(`duvida-expandida-${index}`);
            expandida.classList.toggle('ativa');
        }

        function enviarDuvida() {
            const nome = document.getElementById('duvida-nome').value;
            const cidade = document.getElementById('duvida-cidade').value;
            const area = document.getElementById('duvida-area').value;
            const resumo = document.getElementById('duvida-resumo').value;
            const descricao = document.getElementById('duvida-descricao').value;
            
            if (!nome || !cidade || !area || !resumo || !descricao) {
                Utils.mostrarFeedback('Por favor, preencha todos os campos', 'danger');
                return;
            }
            
            const duvida = {
                id: Date.now().toString(),
                nome: nome,
                cidade: cidade,
                area: area,
                resumo: resumo,
                descricao: descricao,
                data: new Date().toISOString(),
                respostas: []
            };
            
            DB.duvidas.unshift(duvida);
            DB.salvar();
            
            Utils.mostrarFeedback('D√∫vida enviada com sucesso!');
            
            // Limpar formul√°rio
            document.getElementById('duvida-nome').value = '';
            document.getElementById('duvida-cidade').value = '';
            document.getElementById('duvida-area').value = '';
            document.getElementById('duvida-resumo').value = '';
            document.getElementById('duvida-descricao').value = '';
            document.getElementById('contador-resumo').textContent = '0/200 caracteres';
        }

        function enviarResposta(index) {
            const respostaTexto = document.getElementById(`resposta-${index}`).value;
            
            if (!respostaTexto) {
                Utils.mostrarFeedback('Por favor, digite uma resposta', 'danger');
                return;
            }
            
            if (!DB.duvidas[index].respostas) {
                DB.duvidas[index].respostas = [];
            }
            
            DB.duvidas[index].respostas.push({
                autor: 'Advogado', // Poderia ser personalizado
                conteudo: respostaTexto,
                data: new Date().toISOString()
            });
            
            DB.salvar();
            Utils.mostrarFeedback('Resposta enviada com sucesso!');
            document.getElementById(`resposta-${index}`).value = '';
            
            // Recarregar a d√∫vida para mostrar a nova resposta
            carregarDuvidas();
            // Manter a d√∫vida expandida
            document.getElementById(`duvida-expandida-${index}`).classList.add('ativa');
        }

        function excluirDuvida(index) {
            if (confirm('Tem certeza que deseja excluir esta d√∫vida?')) {
                DB.duvidas.splice(index, 1);
                DB.salvar();
                Utils.mostrarFeedback('D√∫vida exclu√≠da com sucesso!');
                carregarDuvidas();
            }
        }

        function filtrarDuvidas(area) {
            // Atualizar bot√µes de filtro
            document.querySelectorAll('.filtro-btn').forEach(btn => {
                btn.classList.remove('ativo');
            });
            event.target.classList.add('ativo');
            
            if (area === 'todas') {
                carregarDuvidas();
                return;
            }
            
            const duvidasFiltradas = DB.duvidas.filter(duvida => duvida.area === area);
            const container = document.getElementById('lista-duvidas');
            
            if (duvidasFiltradas.length === 0) {
                container.innerHTML = `<div class="alert alert-info">Nenhuma d√∫vida na √°rea ${area}.</div>`;
                return;
            }
            
            container.innerHTML = duvidasFiltradas.map((duvida, index) => {
                const originalIndex = DB.duvidas.findIndex(d => d.id === duvida.id);
                return `
                    <div class="lista-duvidas-item" onclick="toggleDuvida(${originalIndex})">
                        <div class="lista-duvidas-header">
                            <div>
                                <div class="duvida-resumo">${duvida.resumo}</div>
                                <div class="duvida-info">
                                    <span>Por: ${duvida.nome} (${duvida.cidade})</span>
                                    <span>${new Date(duvida.data).toLocaleString()}</span>
                                </div>
                            </div>
                            <div>
                                <span class="duvida-area">${duvida.area}</span>
                                <button class="btn-excluir-duvida" onclick="event.stopPropagation(); excluirDuvida(${originalIndex})">Excluir</button>
                            </div>
                        </div>
                        <div class="duvida-expandida" id="duvida-expandida-${originalIndex}">
                            <div><strong>Descri√ß√£o completa:</strong> ${duvida.descricao}</div>
                            ${duvida.respostas && duvida.respostas.length > 0 ? `
                                <div style="margin-top: 15px;">
                                    <strong>Respostas (${duvida.respostas.length}):</strong>
                                    ${duvida.respostas.map(resposta => `
                                        <div class="resposta-item">
                                            <strong>${resposta.autor} (${new Date(resposta.data).toLocaleString()}):</strong><br>
                                            ${resposta.conteudo}
                                        </div>
                                    `).join('')}
                                </div>
                            ` : '<div style="margin-top: 10px; color: #6c757d;">Nenhuma resposta ainda.</div>'}
                            <div class="form-resposta">
                                <div class="form-group">
                                    <label>Sua Resposta:</label>
                                    <textarea id="resposta-${originalIndex}" rows="3" placeholder="Digite sua resposta aqui..."></textarea>
                                </div>
                                <button class="btn btn-small" onclick="enviarResposta(${originalIndex})">üì§ Enviar Resposta</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function atualizarContadorResumo() {
            const resumo = document.getElementById('duvida-resumo');
            const contador = document.getElementById('contador-resumo');
            contador.textContent = `${resumo.value.length}/200 caracteres`;
        }

        function executarAutoReparo() {
            // Verificar e reparar dados corrompidos
            let reparos = 0;
            
            // Verificar clientes
            DB.clientes = DB.clientes.filter(cliente => 
                cliente && cliente.codigo && cliente.nome
            );
            
            // Verificar processos
            DB.processos = DB.processos.filter(processo => 
                processo && processo.id && processo.numero && processo.tipo
            );
            
            // Verificar andamentos
            DB.andamentos = DB.andamentos.filter(andamento => 
                andamento && andamento.id && andamento.descricao
            );
            
            // Verificar teses
            if (!DB.teses) DB.teses = { inicial: {}, impugnacao: {}, recurso: {} };
            if (!DB.teses.inicial) DB.teses.inicial = {};
            if (!DB.teses.impugnacao) DB.teses.impugnacao = {};
            if (!DB.teses.recurso) DB.teses.recurso = {};
            
            // Verificar d√∫vidas
            DB.duvidas = DB.duvidas.filter(duvida => 
                duvida && duvida.id && duvida.resumo
            );
            
            DB.salvar();
            Utils.mostrarFeedback('Sistema verificado e reparado com sucesso!');
        }

        function atualizarSistema() {
            DB.atualizarInterface();
            Utils.mostrarFeedback('Sistema atualizado!');
        }

        // ========== INICIALIZA√á√ÉO ==========
        function inicializarSistema() {
            Interface.inicializar();
            document.getElementById('processo-data').valueAsDate = new Date();
            document.getElementById('cliente-codigo').value = DB.gerarCodigoCliente();
            console.log('üöÄ Sistema Jur√≠dico Refatorado carregado!');
        }

        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', inicializarSistema);
    </script>
</body>
</html>